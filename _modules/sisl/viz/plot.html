<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sisl.viz.plot &mdash; sisl 0.1.dev1+g851d78c documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> sisl
          </a>
              <div class="version">
                0.1.dev1+g851d78c
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../other.html">Other resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cite.html">Citing sisl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications using sisl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts/scripts.html">Command line scripts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Toolboxes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../toolbox/index.html">Toolboxes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Visualization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/ase/index.html">ASE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../visualization/viz_module/index.html">The <code class="docutils literal notranslate"><span class="pre">sisl.viz</span></code> module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">sisl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">sisl.viz.plot</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sisl.viz.plot</h1><div class="highlight"><pre>
<span></span><span class="c1"># This Source Code Form is subject to the terms of the Mozilla Public</span>
<span class="c1"># License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<span class="c1"># file, You can obtain one at https://mozilla.org/MPL/2.0/.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file contains the Plot class, which should be inherited by all plot classes</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">MethodType</span><span class="p">,</span> <span class="n">FunctionType</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">sisl</span>
<span class="kn">from</span> <span class="nn">sisl.messages</span> <span class="kn">import</span> <span class="n">info</span><span class="p">,</span> <span class="n">warn</span>

<span class="kn">from</span> <span class="nn">.backends._plot_backends</span> <span class="kn">import</span> <span class="n">Backends</span>
<span class="kn">from</span> <span class="nn">.configurable</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Configurable</span><span class="p">,</span> <span class="n">ConfigurableMeta</span><span class="p">,</span>
    <span class="n">vizplotly_settings</span><span class="p">,</span> <span class="n">_populate_with_settings</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">._presets</span> <span class="kn">import</span> <span class="n">get_preset</span>
<span class="kn">from</span> <span class="nn">.plotutils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">init_multiple_plots</span><span class="p">,</span> <span class="n">repeat_if_children</span><span class="p">,</span> <span class="n">dictOfLists2listOfDicts</span><span class="p">,</span>
    <span class="n">trigger_notification</span><span class="p">,</span> <span class="n">spoken_message</span><span class="p">,</span>
    <span class="n">running_in_notebook</span><span class="p">,</span> <span class="n">check_widgets</span><span class="p">,</span> <span class="n">call_method_if_present</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.input_fields</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TextInput</span><span class="p">,</span> <span class="n">SileInput</span><span class="p">,</span> <span class="n">BoolInput</span><span class="p">,</span>
    <span class="n">OptionsInput</span><span class="p">,</span> <span class="n">IntegerInput</span><span class="p">,</span>
    <span class="n">ListInput</span><span class="p">,</span> <span class="n">ProgramaticInput</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">._shortcuts</span> <span class="kn">import</span> <span class="n">ShortCutable</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Plot&quot;</span><span class="p">,</span> <span class="s2">&quot;MultiplePlot&quot;</span><span class="p">,</span> <span class="s2">&quot;Animation&quot;</span><span class="p">,</span> <span class="s2">&quot;SubPlots&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">PlotMeta</span><span class="p">(</span><span class="n">ConfigurableMeta</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This method decides what to return when the plot class is instantiated.</span>

<span class="sd">        It is supposed to help the users by making the plot class very functional</span>
<span class="sd">        without the need for the users to use extra methods.</span>

<span class="sd">        It will catch the first argument and initialize the corresponding plot</span>
<span class="sd">        if the first argument is:</span>
<span class="sd">            - A string, it will be assumed that it is a path to a file.</span>
<span class="sd">            - A plotable object (has a _plot attribute)</span>

<span class="sd">        Note that both cases are registered in the _plotables.py file, and you</span>
<span class="sd">        can register new siles/plotables by using the register functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>

            <span class="c1"># This is just so that the plotable framework knows from which plot class</span>
            <span class="c1"># it is being called so that it can build the corresponding plot.</span>
            <span class="c1"># Only relevant if the plot is built with obj.plot()</span>
            <span class="n">plot_method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plot_method&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">suffix</span><span class="p">())</span>

            <span class="c1"># If a filename is recieved, we will try to find a plot for it</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>

                <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sile</span> <span class="o">=</span> <span class="n">sisl</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sile</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">):</span>
                    <span class="n">plot</span> <span class="o">=</span> <span class="n">sile</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">plot_method</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;There is no plot implementation for </span><span class="si">{</span><span class="n">sile</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s1"> yet.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Plot</span><span class="p">):</span>
                <span class="n">plot</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Maybe the first argument is a plotable object (e.g. a geometry)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;plot&quot;</span><span class="p">):</span>
                    <span class="n">plot</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">plot_method</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">plot</span>

        <span class="k">elif</span> <span class="s1">&#39;animate&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;varying&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s1">&#39;subplots&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>

            <span class="n">methods</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;animate&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">animated</span><span class="p">,</span> <span class="s1">&#39;varying&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">multiple</span><span class="p">,</span> <span class="s1">&#39;subplots&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">subplots</span><span class="p">}</span>
            <span class="c1"># Retrieve the keyword that was actually passed</span>
            <span class="c1"># and choose the appropiate method</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;animate&#39;</span><span class="p">,</span> <span class="s1">&#39;varying&#39;</span><span class="p">,</span> <span class="s1">&#39;subplots&#39;</span><span class="p">):</span>
                <span class="n">variable_settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">variable_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span>
                    <span class="k">break</span>

            <span class="c1"># Normalize all accepted input types to a dict</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_settings</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">variable_settings</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable_settings</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_settings</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">variable_settings</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">variable_settings</span><span class="p">}</span>

            <span class="c1"># Just run the method that will get us the desired plot</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">variable_settings</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">plot</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="Plot"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot">[docs]</a><span class="k">class</span> <span class="nc">Plot</span><span class="p">(</span><span class="n">ShortCutable</span><span class="p">,</span> <span class="n">Configurable</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">PlotMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Parent class of all plot classes</span>

<span class="sd">    Implements general things needed by all plots such as settings and shortcut</span>
<span class="sd">    management.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root_fdf: fdfSileSiesta, optional</span>
<span class="sd">        Path to the fdf file that is the &#39;parent&#39; of the results.</span>
<span class="sd">    results_path: str, optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    entry_points_order: array-like, optional</span>
<span class="sd">        Order with which entry points will be attempted.</span>
<span class="sd">    backend:  optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    settings: dict</span>
<span class="sd">        contains the values for each setting of the plot.</span>
<span class="sd">    params: dict</span>
<span class="sd">        for each setting, contains information about their input field.</span>

<span class="sd">        This information might include valid values, for example.</span>
<span class="sd">    paramGroups: tuple of dicts</span>
<span class="sd">        contains the different setting groups present in the plot.</span>

<span class="sd">        Each group is a dict like { &quot;key&quot;: , &quot;name&quot;: ,&quot;icon&quot;: , &quot;description&quot;: }</span>
<span class="sd">    ...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_update_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;read_data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;set_data&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;get_figure&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="n">_param_groups</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;dataread&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Data reading settings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="s2">&quot;import_export&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;In such a busy world, one may forget how the files are structured in their computer. Please take a moment to &lt;b&gt;make sure your data is being read exactly in the way you expect&lt;b&gt;.&quot;</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="n">_parameters</span> <span class="o">=</span> <span class="p">(</span>

        <span class="n">SileInput</span><span class="p">(</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;root_fdf&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Path to fdf file&quot;</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">sisl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">siesta</span><span class="o">.</span><span class="n">fdfSileSiesta</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dataread&quot;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the fdf file that is the &#39;parent&#39; of the results.&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Write the path here...&quot;</span>
            <span class="p">}</span>
        <span class="p">),</span>

        <span class="n">TextInput</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;results_path&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Path to your results&quot;</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dataread&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Write the path here...&quot;</span>
            <span class="p">},</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Directory where the files with the simulations results are located.&lt;br&gt; This path has to be relative to the root fdf.&quot;</span><span class="p">,</span>
        <span class="p">),</span>

        <span class="n">ListInput</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;entry_points_order&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Entry points order&quot;</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;dataread&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;itemInput&quot;</span><span class="p">:</span> <span class="n">OptionsInput</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[]})</span>
            <span class="p">},</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Order with which entry points will be attempted.&quot;&quot;&quot;</span>
        <span class="p">),</span>

        <span class="n">OptionsInput</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;backend&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Backend&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Directory where the files with the simulations results are located.&lt;br&gt; This path has to be relative to the root fdf.&quot;</span><span class="p">,</span>
        <span class="p">),</span>

    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">read_data_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">entry_points_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry_point</span><span class="o">.</span><span class="n">_method</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_points</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;_before_read&quot;</span><span class="p">,</span> <span class="s2">&quot;_after_read&quot;</span><span class="p">,</span> <span class="s2">&quot;_read_from_sources&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">entry_points_names</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_methods</span><span class="p">[</span><span class="s2">&quot;read_data&quot;</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">set_data_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;_set_data&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_methods</span><span class="p">[</span><span class="s2">&quot;set_data&quot;</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_figure_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;_after_get_figure&quot;</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_methods</span><span class="p">[</span><span class="s2">&quot;get_figure&quot;</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_parse_update_funcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Decides which functions to run when the settings of the plot are updated</span>

<span class="sd">        This is called in self._run_updates as a final oportunity to decide what functions to run.</span>

<span class="sd">        In the case of plots, all we basically want to know is if we need to read the data again (execute</span>
<span class="sd">        `read_data`), set new data for the plot without needing to read (execute `set_data`) or just update </span>
<span class="sd">        some aesthetic aspects of the plot (execute `get_figure`).</span>

<span class="sd">        When Plot sees one of the following functions in the list of functions with updated parameters:</span>
<span class="sd">            - &quot;_before_read&quot;, &quot;_after_read&quot;, any entry point function, functions in cls._update_methods[&quot;read_data&quot;]</span>

<span class="sd">        it knows that `read_data` needs to be executed. (which afterwards triggers `set_data` and `get_figure`).</span>

<span class="sd">        Otherwise, if any of this functions is present:</span>
<span class="sd">            - &quot;_set_data&quot;, functions in cls._update_methods[&quot;set_data&quot;]</span>

<span class="sd">        it executes `set_data` (and `get_figure` subsequentially)</span>

<span class="sd">        Finally, if it finds:</span>
<span class="sd">            - &quot;_after_get_figure&quot;, functions in cls._update_methods[&quot;get_figure&quot;]</span>

<span class="sd">        it executes `get_figure`.</span>

<span class="sd">        WARNING: If it doesn&#39;t find any of these, it will return the unparsed list of functions,</span>
<span class="sd">        and all functions will get executed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        func_names: set of str</span>
<span class="sd">            the unique functions names that are to be executed unless you modify them.</span>

<span class="sd">        Returns</span>
<span class="sd">        -----------</span>
<span class="sd">        array-like of str</span>
<span class="sd">            the final list of functions that will be executed.</span>

<span class="sd">        See also</span>
<span class="sd">        ------------</span>
<span class="sd">        ``Configurable._run_updates``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data_methods</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;read_data&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_data_methods</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;set_data&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_figure_methods</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;get_figure&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">func_names</span>

<div class="viewcode-block" id="Plot.from_plotly"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.from_plotly">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_plotly</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">plotly_fig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Converts a plotly plot to a Plot object</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        plotly_fig: plotly.graph_objs.Figure</span>
<span class="sd">            the figure that we want to convert into a sisl plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -----------</span>
<span class="sd">        Plot</span>
<span class="sd">            the converted plot that contains the plotly figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">only_init</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">plotly_fig</span>

        <span class="k">return</span> <span class="n">plot</span></div>

<div class="viewcode-block" id="Plot.plot_name"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.plot_name">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The name of the plot. Used to be displayed in the GUI, for example &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_plot_type&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plot.suffix"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.suffix">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">suffix</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the suffix that this class adds to plotting functions</span>

<span class="sd">        See sisl/viz/_plotables.py and particularly the `register_plotable`</span>
<span class="sd">        function to understand this better.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">Plot</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_suffix&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Plot.entry_points_help"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.entry_points_help">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">entry_points_help</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates a helpful message about the entry points of the plot class &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">entry_points</span><span class="p">:</span>

            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entry_point</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">------------</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="p">(</span><span class="n">entry_point</span><span class="o">.</span><span class="n">help</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

            <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Settings used:</span><span class="se">\n\t</span><span class="s2">- &quot;</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">- &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ab</span><span class="p">:</span> <span class="n">ab</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">_method</span><span class="o">.</span><span class="n">_settings</span><span class="p">))</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">string</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_innotebook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Boolean indicating whether this plot is being used in a notebook</span>

<span class="sd">        Used to understand how we should display the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">running_in_notebook</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Dictionary that informs of which jupyter notebook widgets are available &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">check_widgets</span><span class="p">()</span>

<div class="viewcode-block" id="Plot.multiple"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.multiple">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">multiple</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="p">{},</span> <span class="n">template_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_method</span><span class="o">=</span><span class="s1">&#39;together&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Creates a multiple plot out of a class</span>

<span class="sd">        This class method returns a multiple plot that contains several plots of the same class.</span>
<span class="sd">        It is a general method that serves as a common denominator for building MultiplePlot, SubPlot</span>
<span class="sd">        or Animation objects. Therefore, it is used by the `animated` and `subplots` methods</span>

<span class="sd">        If no arguments are passed, you will get the default multiple plot for the class, if there is any.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        *args:</span>
<span class="sd">            Depending on what you pass the arguments will be interpreted differently:</span>
<span class="sd">                - Two arguments:</span>
<span class="sd">                    First: str</span>
<span class="sd">                        Key of the setting that you want to be variable.</span>
<span class="sd">                    Second: array-like</span>
<span class="sd">                        Values that you want the setting to have in each individual plot.</span>

<span class="sd">                    Ex: BandsPlot.multiple(&quot;bands_file&quot;, [&quot;file1&quot;, &quot;file2&quot;, &quot;file3&quot;] )</span>
<span class="sd">                    will produce a multiple plot where each plot uses a different bands_file.</span>

<span class="sd">                - One argument and it is a dictionary:</span>
<span class="sd">                    First: dict</span>
<span class="sd">                        The keys of this dictionary will be the setting keys you want to be variable</span>
<span class="sd">                        and the values are of course the values for each plot for that setting. </span>

<span class="sd">                    It works exactly as the previous case, but in this case we have multiple settings that vary.</span>

<span class="sd">                - One argument and it is a function:</span>
<span class="sd">                    First: function</span>
<span class="sd">                        With this function you can produce any settings you want without limitations.</span>

<span class="sd">                        It will be used as the `_getInitKwargsList` method of the MultiplePlot object, so it needs to</span>
<span class="sd">                        accept self (the MultiplePlot object) and return a list of dictionaries which are the </span>
<span class="sd">                        settings for each plot.</span>

<span class="sd">        fixed: dict, optional</span>
<span class="sd">            A dictionary containing values for settings that will be fixed for all plots.</span>
<span class="sd">            For the settings that you don&#39;t specify here you will get the defaults.</span>
<span class="sd">        template_plot: sisl Plot, optional</span>
<span class="sd">            If provided this plot will be used as a template.</span>

<span class="sd">            It is important to know that it will not act only as the settings template,</span>
<span class="sd">            but it will also PROVIDE DATA FOR THE OTHER PLOTS in case the data reading</span>
<span class="sd">            settings are not being varied through the different plots.</span>

<span class="sd">            This is extremely important to provide when possible, because in some cases the data</span>
<span class="sd">            that a plot gathers can be very large and therefore it may not be even feasable to store</span>
<span class="sd">            the repeated data in terms of memory/time.</span>
<span class="sd">        merge_method: {&#39;together&#39;, &#39;subplots&#39;, &#39;animation&#39;}, optional</span>
<span class="sd">            the way in which the multiple plots are &#39;related&#39; to each other (i.e. how they should be displayed).</span>
<span class="sd">            In most cases, instead of using this argument, you should probably use the specific method (`animated` or</span>
<span class="sd">            `subplots`). They set this argument accordingly but also do some other work to make your life easier.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Will be passed directly to initialization, so it can contain the settings for the MultiplePlot object, for example.</span>

<span class="sd">            If args are not passed and the default multiple plot is being created, some keyword arguments may be used by the method</span>
<span class="sd">            that generates the default multiple plot. One recurrent example of this is the keyword `wdir`. </span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        MultiplePlot, SubPlots or Animation</span>
<span class="sd">            The plot that you asked for. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Try to retrieve the default animation if no arguments are provided</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_default_animation&quot;</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#Define how the getInitkwargsList method will look like</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">_getInitKwargsList</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">variable_settings</span> <span class="o">=</span> <span class="p">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">variable_settings</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">_getInitKwargsList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

                <span class="c1">#Adding the fixed values to the list</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fixed</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
                    <span class="o">**</span><span class="n">variable_settings</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="n">dictOfLists2listOfDicts</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

        <span class="c1"># Choose the specific class that we want to initialize</span>
        <span class="n">MultipleClass</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;together&#39;</span><span class="p">:</span> <span class="n">MultiplePlot</span><span class="p">,</span> <span class="s1">&#39;subplots&#39;</span><span class="p">:</span> <span class="n">SubPlots</span><span class="p">,</span> <span class="s1">&#39;animation&#39;</span><span class="p">:</span> <span class="n">Animation</span><span class="p">}[</span><span class="n">merge_method</span><span class="p">]</span>

        <span class="c1">#Return the initialized multiple plot</span>
        <span class="k">return</span> <span class="n">MultipleClass</span><span class="p">(</span><span class="n">_plugins</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;_getInitKwargsList&quot;</span><span class="p">:</span> <span class="n">_getInitKwargsList</span><span class="p">,</span>
            <span class="s2">&quot;_plot_classes&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_plugins&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">},</span> <span class="n">template_plot</span><span class="o">=</span><span class="n">template_plot</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plot.subplots"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.subplots">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">subplots</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="p">{},</span> <span class="n">template_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arrange</span><span class="o">=</span><span class="s2">&quot;rows&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Creates subplots where each plot has different settings</span>

<span class="sd">        Mainly, it uses the `multiple` method to generate them.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        *args:</span>
<span class="sd">            Depending on what you pass the arguments will be interpreted differently:</span>
<span class="sd">                - Two arguments:</span>
<span class="sd">                    First: str</span>
<span class="sd">                        Key of the setting that you want to vary across subplots.</span>
<span class="sd">                    Second: array-like</span>
<span class="sd">                        Values that you want the setting to have in each subplot.</span>

<span class="sd">                    Ex: BandsPlot.multiple(&quot;bands_file&quot;, [&quot;file1&quot;, &quot;file2&quot;, &quot;file3&quot;] )</span>
<span class="sd">                    will produce a layout where each subplot uses a different bands_file.</span>

<span class="sd">                - One argument and it is a dictionary:</span>
<span class="sd">                    First: dict</span>
<span class="sd">                        The keys of this dictionary will be the setting keys you want to vary across subplots</span>
<span class="sd">                        and the values are of course the values for each plot for that setting. </span>

<span class="sd">                    It works exactly as the previous case, but in this case we have multiple settings that vary.</span>

<span class="sd">                - One argument and it is a function:</span>
<span class="sd">                    First: function</span>
<span class="sd">                        With this function you can produce any settings you want without limitations.</span>

<span class="sd">                        It will be used as the `_getInitKwargsList` method of the MultiplePlot object, so it needs to</span>
<span class="sd">                        accept self (the MultiplePlot object) and return a list of dictionaries which are the </span>
<span class="sd">                        settings for each plot.</span>

<span class="sd">        fixed: dict, optional</span>
<span class="sd">            A dictionary containing values for settings that will be fixed for all subplots.</span>
<span class="sd">            For the settings that you don&#39;t specify here you will get the defaults.</span>
<span class="sd">        template_plot: sisl Plot, optional</span>
<span class="sd">            If provided this plot will be used as a template.</span>

<span class="sd">            It is important to know that it will not act only as the settings template,</span>
<span class="sd">            but it will also PROVIDE DATA FOR THE OTHER PLOTS in case the data reading</span>
<span class="sd">            settings are not being varied through the different plots.</span>

<span class="sd">            This is extremely important to provide when possible, because in some cases the data</span>
<span class="sd">            that a plot gathers can be very large and therefore it may not be even feasable to store</span>
<span class="sd">            the repeated data in terms of memory/time.</span>
<span class="sd">        rows: int, optional</span>
<span class="sd">            The number of rows of the plot grid. If not provided, it will be inferred from `cols`</span>
<span class="sd">            and the number of plots. If neither `cols` or `rows` are provided, the `arrange` parameter will decide</span>
<span class="sd">            how the layout should look like.</span>
<span class="sd">        cols: int, optional</span>
<span class="sd">            The number of columns of the subplot grid. If not provided, it will be inferred from `rows`</span>
<span class="sd">            and the number of plots. If neither `cols` or `rows` are provided, the `arrange` parameter will decide</span>
<span class="sd">            how the layout should look like.</span>
<span class="sd">        arrange: {&#39;rows&#39;, &#39;col&#39;, &#39;square&#39;}, optional</span>
<span class="sd">            The way in which subplots should be aranged if the `rows` and/or `cols`</span>
<span class="sd">            parameters are not provided.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Will be passed directly to SubPlots initialization, so it can contain the settings for it, for example.</span>

<span class="sd">            If args are not passed and the default multiple plot is being created, some keyword arguments may be used by the method</span>
<span class="sd">            that generates the default multiple plot. One recurrent example of this is the keyword `wdir`. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">,</span> <span class="n">template_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_method</span><span class="o">=</span><span class="s1">&#39;subplots&#39;</span><span class="p">,</span>
                <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">arrange</span><span class="o">=</span><span class="n">arrange</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plot.animated"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.animated">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">animated</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="p">{},</span> <span class="n">frame_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Creates an animation out of a class</span>

<span class="sd">        This class method returns an animation with frames belonging to a given plot class.</span>

<span class="sd">        For example, if you run `BandsPlot.animated()` you will get an animation made of bands plots.</span>

<span class="sd">        If no arguments are passed, you will get the default animation for that plot, if there is any.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        *args:</span>
<span class="sd">            Depending on what you pass the arguments will be interpreted differently:</span>
<span class="sd">                - Two arguments:</span>
<span class="sd">                    First: str</span>
<span class="sd">                        Key of the setting that you want to animate.</span>
<span class="sd">                    Second: array-like</span>
<span class="sd">                        Values that you want the setting to have at each animation frame.</span>

<span class="sd">                    Ex: BandsPlot.animated(&quot;bands_file&quot;, [&quot;file1&quot;, &quot;file2&quot;, &quot;file3&quot;] )</span>
<span class="sd">                    will produce an animation where each frame uses a different bands_file.</span>

<span class="sd">                - One argument and it is a dictionary:</span>
<span class="sd">                    First: dict</span>
<span class="sd">                        The keys of this dictionary will be the setting keys you want to animate</span>
<span class="sd">                        and the values are of course the values for each frame for that setting. </span>

<span class="sd">                    It works exactly as the previous case, but in this case we have multiple settings to animate.</span>

<span class="sd">                - One argument and it is a function:</span>
<span class="sd">                    First: function</span>
<span class="sd">                        With this function you can produce any settings you want without limitations.</span>

<span class="sd">                        It will be used as the `_getInitKwargsList` method of the animation, so it needs to</span>
<span class="sd">                        accept self (the animation object) and return a list of dictionaries which are the </span>
<span class="sd">                        settings for each frame.</span>

<span class="sd">                    the function will recieve the parameter and can act on it in any way you like.</span>
<span class="sd">                    It doesn&#39;t need to return the parameter, just modify it.</span>
<span class="sd">                    In this function, you can call predefined methods of the parameter, for example.</span>

<span class="sd">                    Ex: obj.modify_param(&quot;length&quot;, lambda param: param.incrementByOne() )</span>

<span class="sd">                    given that you know that this type of parameter has this method.</span>
<span class="sd">        fixed: dict, optional</span>
<span class="sd">            A dictionary containing values for settings that will be fixed along the animation.</span>
<span class="sd">            For the settings that you don&#39;t specify here you will get the defaults.</span>
<span class="sd">        frame_names: list of str or function, optional</span>
<span class="sd">            If it is a list of strings, each string will be used as the name for the corresponding frame.</span>

<span class="sd">            If it is a function, it should accept `self` (the animation object) and return a list of strings</span>
<span class="sd">            with the frame names. Note that you can access the plot instance responsible for each frame under</span>
<span class="sd">            `self.children`. The function will be run each time the figure is generated, so in this way your</span>
<span class="sd">            frame names will be dynamic.</span>

<span class="sd">            FRAME NAMES SHOULD BE UNIQUE, OTHERWISE THE ANIMATION WILL HAVE A WEIRD BEHAVIOR.</span>

<span class="sd">            If this is not provided, frame names will be generated automatically.</span>
<span class="sd">        template_plot: sisl Plot, optional</span>
<span class="sd">            If provided this plot will be used as a template.</span>

<span class="sd">            It is important to know that it will not act only as the settings template,</span>
<span class="sd">            but it also will PROVIDE DATA FOR THE OTHER PLOTS in case the data reading</span>
<span class="sd">            settings are not animated.</span>

<span class="sd">            This is extremely important to provide when possible, because in some cases the data</span>
<span class="sd">            that a plot gathers can be very large and therefore it may not be even feasable to store</span>
<span class="sd">            the repeated data in terms of memory/time. </span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Will be passed directly to animation initialization, so it can contain the settings for the animation, for example.</span>

<span class="sd">            If args are not passed and the default animation is being created. Some keyword arguments may be used by the method</span>
<span class="sd">            that generates the default animation. One recurrent example of this is the keyword `wdir`. </span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Animation</span>
<span class="sd">            The Animation that you asked for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># And just let the general multiple plot creator do the work</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">multiple</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">,</span> <span class="n">template_plot</span><span class="o">=</span><span class="n">template_plot</span><span class="p">,</span> <span class="n">merge_method</span><span class="o">=</span><span class="s1">&#39;animation&#39;</span><span class="p">,</span>
                            <span class="n">frame_names</span><span class="o">=</span><span class="n">frame_names</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Whenever a plot class is defined, this method is called</span>

<span class="sd">        We will use this opportunity to:</span>
<span class="sd">            - Register entry points.</span>
<span class="sd">            - Generate a more helpful __init__ method that exposes all the settings.</span>

<span class="sd">        We could use this to register plotables (see commented code).</span>
<span class="sd">        However, there is one major problem: how to specify defaults.</span>
<span class="sd">        This is a problem because sometimes an input field is inherited from one plot</span>
<span class="sd">        to another, therefore you can not say: &quot;this is the default plotable input&quot;.</span>

<span class="sd">        Probably, defaults should be centralized, but I don&#39;t know where just yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">()</span>

        <span class="c1"># Register the entry points of this class.</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">entry_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">EntryPoint</span><span class="p">)):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">entry_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c1"># After registering an entry point, we will just set the method</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_populate_with_settings</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">_method</span><span class="p">,</span> <span class="p">[</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_class_params</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="n">entry_points_order</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_class_param</span><span class="p">(</span><span class="s2">&quot;entry_points_order&quot;</span><span class="p">)</span>
        <span class="n">entry_points_order</span><span class="o">.</span><span class="n">modify_item_input</span><span class="p">(</span>
            <span class="s2">&quot;inputField.params.options&quot;</span><span class="p">,</span>
            <span class="p">[{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">_name</span><span class="p">}</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">entry_points</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">entry_points_order</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span>
            <span class="s2">&quot;default&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">_name</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">entry_points</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">_sort_key</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">backends</span> <span class="o">=</span> <span class="n">Backends</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

<div class="viewcode-block" id="Plot.__init__"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.__init__">[docs]</a>    <span class="nd">@vizplotly_settings</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attrs_for_plot</span><span class="o">=</span><span class="p">{},</span> <span class="n">only_init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">presets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">{},</span> <span class="n">_debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Give an ID to the plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="c1"># Inform whether the plot is in debug mode or not:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">_debug</span>

        <span class="c1"># Initialize shortcut management</span>
        <span class="n">ShortCutable</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Give the user the possibility to do things before initialization (IDK why)</span>
        <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_before_init&quot;</span><span class="p">)</span>

        <span class="c1">#Set the isChildPlot attribute to let the plot know if it is part of a bigger picture (e.g. Animation)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isChildPlot</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isChildPlot&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1">#Initialize the variable to store when has been the last data read (0 means never basically)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_dataread</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files_to_follow</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check if the user has provided a hamiltonian (which can contain a geometry)</span>
        <span class="c1"># This is not meant to be used by the GUI (in principle), just programatically</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDED_H</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDED_GEOM</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">H</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDED_H</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_hamiltonian</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">presets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">presets</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">presets</span> <span class="o">=</span> <span class="p">[</span><span class="n">presets</span><span class="p">]</span>

        <span class="c1"># on_figure_change is triggered after get_figure.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_figure_change</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set all the attributes that have been passed</span>
        <span class="c1"># It is important that this is here so that it can overwrite any of</span>
        <span class="c1"># the already written attributes</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">attrs_for_plot</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1">#If plugins have been provided, then add them.</span>
        <span class="c1">#Plugins are an easy way of extending a plot. They can be methods, variables...</span>
        <span class="c1">#They are added to the object instance, not the whole class.</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_plugins&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_plugins&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">FunctionType</span><span class="p">):</span>
                    <span class="n">plugin</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">plugin</span><span class="p">)</span>

        <span class="c1"># Add the general plot shortcuts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_general_plot_shortcuts</span><span class="p">()</span>

        <span class="c1">#Give the user the possibility to overwrite default settings</span>
        <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_after_init&quot;</span><span class="p">)</span>

        <span class="c1"># If we were supposed to only initialize the plot, stop here</span>
        <span class="k">if</span> <span class="n">only_init</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1">#Try to generate the figure (if the settings required are still not there, it won&#39;t be generated)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">MultiplePlot</span> <span class="ow">in</span> <span class="nb">type</span><span class="o">.</span><span class="n">mro</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="c1">#If its a multiple plot try to inititialize all its child plots</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PLOTS_PROVIDED</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">init_all_plots</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The plot has been initialized correctly, but the current settings were not enough to generate the figure.</span><span class="se">\n</span><span class="s2">Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Information to print about the plot &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Plot class: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">    Plot type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span><span class="p">()</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Settings:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">- </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This method is executed only after python has found that there is no such attribute in the instance</span>

<span class="sd">        So let&#39;s try to find it elsewhere. There are two options:</span>
<span class="sd">            - The attribute is in the backend object (self._backend)</span>
<span class="sd">            - The attribute is currently being shared with other plots (only possible if it&#39;s a childplot)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_backend&quot;</span><span class="p">,</span> <span class="s2">&quot;_get_shared_attr&quot;</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_backend&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#If it is a childPlot, maybe the attribute is in the shared storage to save memory and time</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shared_attr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The attribute &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; was not found either in the plot, its backend, or in shared attributes.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If is a childplot and it has the attribute `_SHOULD_SHARE_WITH_SIBLINGS` set to True, we will submit the attribute to the shared store.</span>
<span class="sd">        This happens in animations/multiple plots. There&#39;s a &quot;leading plot&quot; that reads the data and then shares it with the rest</span>
<span class="sd">        so that they don&#39;t need to read it again, in a collective effort to save memory and time.</span>

<span class="sd">        Otherwise we set the attribute to the plot itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;_SHOULD_SHARE_WITH_SIBLINGS&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_SHOULD_SHARE_WITH_SIBLINGS&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">share_attr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Getting an item from plot returns the trace(s) that correspond to the requested indices &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_general_plot_shortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; In this method we set the shortcuts that are general to all plots</span>

<span class="sd">        This is called in `__init__`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listening_shortcut</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;ctrl+z&quot;</span><span class="p">,</span> <span class="s2">&quot;Undo settings&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">undo_settings</span><span class="p">,</span> <span class="n">_description</span><span class="o">=</span><span class="s2">&quot;Takes the settings of the plot one step back&quot;</span><span class="p">)</span>

    <span class="nd">@repeat_if_children</span>
    <span class="nd">@vizplotly_settings</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This method is responsible for organizing the data-reading step</span>

<span class="sd">        If everything is done succesfully, it calls the next step (`set_data`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Restart the files_to_follow variable so that we can start to fill it with the new files</span>
        <span class="c1"># Apart from the explicit call in this method, setFiles and setup_hamiltonian also add files to follow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files_to_follow</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_before_read&quot;</span><span class="p">)</span>

        <span class="c1"># We try to read from the different entry points available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_from_sources</span><span class="p">()</span>

        <span class="c1"># We don&#39;t update the last dataread here in case there has been a succesful data read because we want to</span>
        <span class="c1"># wait for the after_read() method to be succesful</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_dataread</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_after_read&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_dataread</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">update_fig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">update_fig</span> <span class="o">=</span> <span class="n">update_fig</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_read_from_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_points_order</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Tries to read the data from the different available entry points in the plot class</span>

<span class="sd">        If it fails to read from all entry points, it raises an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># It is possible that the class does not implement any entry points,</span>
        <span class="c1"># because it doesn&#39;t need to read any data. Then the plotting process</span>
        <span class="c1"># will basically start at set_data.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_points</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Try to read data using all the different entry points</span>
        <span class="c1"># This is just a first implementation. One of the reasons entry points</span>
        <span class="c1"># have been implemented is that we can do smarter things than this.</span>
        <span class="k">for</span> <span class="n">entry_point_name</span> <span class="ow">in</span> <span class="n">entry_points_order</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_points</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">entry_point_name</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entry point </span><span class="si">{</span><span class="n">entry_point_name</span><span class="si">}</span><span class="s2"> not found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">returns</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">_method_attr</span><span class="p">)()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">entry_point</span>
                <span class="k">return</span> <span class="n">returns</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">- </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entry_point</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not read or generate data for </span><span class="si">{}</span><span class="s2"> from any of the possible sources.</span><span class="se">\n</span><span class="s2">Here are the errors for each source:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span>
                             <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">)))</span>

<div class="viewcode-block" id="Plot.follow"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.follow">[docs]</a>    <span class="k">def</span> <span class="nf">follow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">,</span> <span class="n">to_abs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unfollow</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Makes sure that the object knows which files to follow in order to trigger updates</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *files: str</span>
<span class="sd">            a string that represents the path to the file that needs to be followed.</span>

<span class="sd">            You can pass as many as you want as separate arguments. Note that if you have a list of</span>
<span class="sd">            files you can pass them separately by doing `follow(*my_list_of_files)`, you don&#39;t need to</span>
<span class="sd">            (and you shouldn&#39;t) build a loop :)</span>
<span class="sd">        to_abs: boolean, optional</span>
<span class="sd">            whether the paths should be converted to absolute paths to make file following procedures</span>
<span class="sd">            more robust. It is better to leave it as True unless you have a good reason to change it.</span>
<span class="sd">        unfollow: boolean, optional</span>
<span class="sd">            whether the previous files should be unfollowed. If set to False, we are just adding more files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">if</span> <span class="n">to_abs</span> <span class="k">else</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span> <span class="ow">or</span> <span class="p">[]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_files_to_follow</span> <span class="o">=</span> <span class="n">new_files</span> <span class="k">if</span> <span class="n">unfollow</span> <span class="k">else</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_files_to_follow</span><span class="p">,</span> <span class="o">*</span><span class="n">new_files</span><span class="p">]</span></div>

<div class="viewcode-block" id="Plot.get_sile"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.get_sile">[docs]</a>    <span class="k">def</span> <span class="nf">get_sile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">results_path</span><span class="p">,</span> <span class="n">root_fdf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">follow_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">file_contents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; A wrapper around get_sile so that the reading of the file is registered</span>

<span class="sd">        It has to main functions:</span>
<span class="sd">            - Automatically following files that are read, so that you don&#39;t neet to go always like:</span>

<span class="sd">                ```</span>
<span class="sd">                self.follow(file)</span>
<span class="sd">                sisl.get_sile(file)</span>
<span class="sd">                ```</span>
<span class="sd">            - Infering files from a root file. For example, using the root_fdf. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            the path to the file that you want to read.</span>
<span class="sd">            It can also be the setting key that you want to read.</span>
<span class="sd">        *args:</span>
<span class="sd">            passed to sisl.get_sile</span>
<span class="sd">        follow: boolean, optional</span>
<span class="sd">            whether the path should be followed.</span>
<span class="sd">        follow_kwargs: dict, optional</span>
<span class="sd">            dictionary of keywords that are passed directly to the follow method.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            passed to sisl.get_sile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If path is a setting name, retrieve it</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">:</span>
            <span class="n">setting_key</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="c1"># However, if it wasn&#39;t provided, try to infer it.</span>
            <span class="c1"># For example, if it is a siesta sile, we will try to infer it</span>
            <span class="c1"># from the fdf file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>

                <span class="n">sile_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="n">setting_key</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span>
                <span class="c1"># We need to check here if it is a SIESTA related sile!</span>

                <span class="n">fdf_sile</span> <span class="o">=</span> <span class="n">sisl</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="n">root_fdf</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">sisl</span><span class="o">.</span><span class="n">get_sile_rules</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">sile_type</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">fdf_sile</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SystemLabel&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;siesta&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">rule</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">fdf_sile</span><span class="o">.</span><span class="n">dir_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">results_path</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">follow_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">file_contents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tried to infer </span><span class="si">{</span><span class="n">setting_key</span><span class="si">}</span><span class="s2"> from the &#39;root_fdf&#39;, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;but didn&#39;t find any </span><span class="si">{</span><span class="n">sile_type</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">fdf_sile</span><span class="o">.</span><span class="n">_directory</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">results_path</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">follow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">follow_kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sisl</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plot.updates_available"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.updates_available">[docs]</a>    <span class="k">def</span> <span class="nf">updates_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This function checks whether the read files have changed</span>

<span class="sd">        For it to work properly, one should specify the files that have been read by</span>
<span class="sd">        their reading methods (usually, the entry points). This is done by using the </span>
<span class="sd">        `follow()` method or by reading files with `self.get_sile()` instead of `sisl.get_sile()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">modified</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_dataread</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># This probably should implement better logic</span>

        <span class="n">files_modified</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">modified</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files_to_follow</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">files_modified</span><span class="o">.</span><span class="n">any</span><span class="p">()</span></div>

<div class="viewcode-block" id="Plot.listen"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.listen">[docs]</a>    <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forever</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_animation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_animation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_figWidget</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">clear_previous</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">speak</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">notify_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">notify_message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">speak_message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Listens for updates in the followed files (see the `updates_available` method)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        forever: boolean, optional</span>
<span class="sd">            whether to keep listening after the first plot update</span>
<span class="sd">        show: boolean, optional</span>
<span class="sd">            whether to show the plot at the beggining and update the layout when the plot is updated.</span>
<span class="sd">        as_animation: boolean, optional</span>
<span class="sd">            will add a new frame each time the plot is updated.</span>

<span class="sd">            The resulting animation is returned unless return_animation is set to False. This is done because</span>
<span class="sd">            the Plot object iself is not converted to an animation. Instead, a new animation is created and if you</span>
<span class="sd">            don&#39;t save it in a variable it will be lost, you will have no way to access it later.</span>

<span class="sd">            If you are seeing two figures at the beggining, it is because you are not storing the animation figure.</span>
<span class="sd">            Set the return_animation parameter to False if you understand that you are going to &quot;lose&quot; the animation,</span>
<span class="sd">            you will only be able to see a display of it while it is there.</span>
<span class="sd">        return_animation: boolean, optional</span>
<span class="sd">            if as_animation is `True`, whether the animation should be returned.</span>
<span class="sd">            Important: see as_animation for an explanation on why this is the case</span>
<span class="sd">        return_figWidget: boolean, optional</span>
<span class="sd">            it returns the figure widget that is in display in a jupyter notebook in case the plot has</span>
<span class="sd">            succeeded to display it. Note that, even if you are in a jupyter notebook, you won&#39;t get a figure</span>
<span class="sd">            widget if you don&#39;t have the plotly notebook extension enabled. Check `&lt;your_plot&gt;._widgets` to see</span>
<span class="sd">            if you are missing witget support.</span>

<span class="sd">            if return_animation is True, both the animation and the figure widget will be returned in a tuple.</span>
<span class="sd">            Although right now, this does not make much sense because figure widgets don&#39;t support frames. You will get None.</span>
<span class="sd">        clear_previous: boolean, optional</span>
<span class="sd">            in case show is True, whether the previous version of the plot should be hidden or kept in display.</span>
<span class="sd">        notify: boolean, optional</span>
<span class="sd">            trigger a notification everytime the plot updates.</span>
<span class="sd">        speak: boolean, optional</span>
<span class="sd">            trigger a spoken message everytime the plot updates.</span>
<span class="sd">        notify_title: str, optional</span>
<span class="sd">            the title of the notification.</span>
<span class="sd">        notify_message: str, optional</span>
<span class="sd">            the message of the notification.</span>
<span class="sd">        speak_message: str, optional</span>
<span class="sd">            the spoken message. Feel free to get creative here!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
        <span class="kn">import</span> <span class="nn">asyncio</span>

        <span class="c1"># This is a weird limitation, because multiple listeners could definitely</span>
        <span class="c1"># be implemented, but I don&#39;t have time now, and I need to ensure that no listeners are left untracked</span>
        <span class="c1"># If you need it, ask me! (Pol)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_listening</span><span class="p">()</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">as_animation</span><span class="p">:</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span>
                <span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">show</span> <span class="ow">and</span> <span class="n">fig_widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">return_figWidget</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fig_widget</span> <span class="o">=</span> <span class="n">fig</span>

        <span class="k">if</span> <span class="n">notify</span><span class="p">:</span>
            <span class="n">trigger_notification</span><span class="p">(</span><span class="s2">&quot;SISL&quot;</span><span class="p">,</span> <span class="s2">&quot;Notifications will appear here&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">speak</span><span class="p">:</span>
            <span class="n">spoken_message</span><span class="p">(</span><span class="s2">&quot;I will speak when there is an update.&quot;</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">listen</span><span class="p">():</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updates_available</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">update_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">as_animation</span><span class="p">:</span>
                            <span class="n">new_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
                            <span class="n">pt</span><span class="o">.</span><span class="n">add_children</span><span class="p">(</span><span class="n">new_plot</span><span class="p">)</span>
                            <span class="n">pt</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">clear_previous</span> <span class="ow">and</span> <span class="n">fig_widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">clear_output</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">show</span> <span class="ow">and</span> <span class="n">fig_widget</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">pt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pt</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">_update_ipywidget</span><span class="p">(</span><span class="n">fig_widget</span><span class="p">)</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">forever</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_listening_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">notify</span><span class="p">:</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="n">notify_title</span> <span class="ow">or</span> <span class="s2">&quot;SISL PLOT UPDATE&quot;</span>
                            <span class="n">message</span> <span class="o">=</span> <span class="n">notify_message</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;struct&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> updated&quot;</span>
                            <span class="n">trigger_notification</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">speak</span><span class="p">:</span>
                            <span class="n">spoken_message</span><span class="p">(</span><span class="n">speak_message</span> <span class="k">if</span> <span class="n">speak_message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is updated. Check it out&quot;</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_listening_task</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">listen</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_shortcut</span><span class="p">(</span><span class="s2">&quot;ctrl+alt+l&quot;</span><span class="p">,</span> <span class="s2">&quot;Stop listening&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_listening</span><span class="p">,</span> <span class="n">fig_widget</span><span class="o">=</span><span class="n">fig_widget</span><span class="p">,</span> <span class="n">_description</span><span class="o">=</span><span class="s2">&quot;Tell the plot to stop listening for updates&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">as_animation</span> <span class="ow">and</span> <span class="n">return_animation</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_figWidget</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pt</span><span class="p">,</span> <span class="n">fig_widget</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pt</span>
        <span class="k">elif</span> <span class="n">return_figWidget</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig_widget</span></div>

    <span class="k">def</span> <span class="nf">_listening_shortcut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Adds the shortcut to start listening for updates</span>

<span class="sd">        This is done here and not in `_general_plot_settings` because</span>
<span class="sd">        we need to be able to toggle this shortcut each time the plot</span>
<span class="sd">        starts/stops listening.</span>

<span class="sd">        Maybe at some point we can have a rule to automatically disable</span>
<span class="sd">        shortcuts based on state in `ShortCutable`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_shortcut</span><span class="p">(</span>
            <span class="s2">&quot;ctrl+alt+l&quot;</span><span class="p">,</span> <span class="s2">&quot;Listen for updates&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listen</span><span class="p">,</span> <span class="n">fig_widget</span><span class="o">=</span><span class="n">fig_widget</span><span class="p">,</span>
            <span class="n">_description</span><span class="o">=</span><span class="s2">&quot;Make the plot listen for changes in the files that it reads&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Plot.stop_listening"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.stop_listening">[docs]</a>    <span class="k">def</span> <span class="nf">stop_listening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Makes the plot stop listening for updates</span>

<span class="sd">        Using this method only makes sense if you have previously made the plot listen</span>
<span class="sd">        either through `Plot.listen()` or `Plot.show(listen=True)`</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        fig_widget: plotly FigureWidget, optional</span>
<span class="sd">            the figure widget where the plot is currently being displayed.</span>

<span class="sd">            This is just used to reset the listening shortcut.</span>

<span class="sd">            YOU WILL MOST LIKELY NOT USE THIS because `Plot` already knows</span>
<span class="sd">            where is it being displayed in normal situations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_listening_task&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_listening_task</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_listening_shortcut</span><span class="p">(</span><span class="n">fig_widget</span><span class="o">=</span><span class="n">fig_widget</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Plot.setup_hamiltonian"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.setup_hamiltonian">[docs]</a>    <span class="nd">@vizplotly_settings</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup_hamiltonian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Sets up the hamiltonian for calculations with sisl &quot;&quot;&quot;</span>
        <span class="n">NEW_FDF</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">NEW_FDF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings_history</span><span class="o">.</span><span class="n">was_updated</span><span class="p">(</span><span class="s2">&quot;root_fdf&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">NEW_FDF</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fdf_sile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="s2">&quot;root_fdf&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">fdf_sile</span><span class="o">.</span><span class="n">read_geometry</span><span class="p">(</span><span class="n">output</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDED_H</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">NEW_FDF</span><span class="p">):</span>
            <span class="c1">#Read the hamiltonian</span>
            <span class="n">fdf_sile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="s2">&quot;root_fdf&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">fdf_sile</span><span class="o">.</span><span class="n">read_hamiltonian</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="n">sisl</span><span class="o">.</span><span class="n">BaseSile</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">read_hamiltonian</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">geometry</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="nd">@repeat_if_children</span>
    <span class="nd">@vizplotly_settings</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_fig</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Method to process the data that has been read beforehand by read_data() and prepare the figure</span>

<span class="sd">        If everything is succesful, it calls the next step in plotting (`get_figure`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_data</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">update_fig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Plot.get_figure"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.get_figure">[docs]</a>    <span class="k">def</span> <span class="nf">get_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">clear_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a figure out of the already processed data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        clear_fig: boolean, optional</span>
<span class="sd">            whether the figure should be cleared before drawing.</span>

<span class="sd">        Returns</span>
<span class="sd">        ---------</span>
<span class="sd">        self.figure: plotly.graph_objs.Figure</span>
<span class="sd">            the plotly figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize the backend</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># It is possible to not use any plotting backend.</span>
            <span class="c1"># In that case, we just simply process the data, but we do not plot anything</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clear_fig</span><span class="p">:</span>
            <span class="c1"># Clear all the traces from the figure before drawing the new ones</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_for_backend&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_after_get_figure&#39;</span><span class="p">)</span>

        <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;on_figure_change&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1">#-------------------------------------------</span>
    <span class="c1">#       PLOT DISPLAY METHODS</span>
    <span class="c1">#-------------------------------------------</span>

<div class="viewcode-block" id="Plot.show"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">listen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_figWidget</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Displays the plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------</span>
<span class="sd">        listen: bool, optional</span>
<span class="sd">            after showing, keeps listening for file changes to update the plot.</span>
<span class="sd">            This is nice for monitoring.</span>
<span class="sd">        return_figureWidget: bool, optional</span>
<span class="sd">            if the plot is displayed in a jupyter notebook, whether you want to</span>
<span class="sd">            get the figure widget as a return so that you can act on it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;There is no plotting backend selected, so the plot can&#39;t be displayed.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">listen</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_innotebook</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="s1">&#39;config&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ipython_display_</span><span class="p">(</span><span class="n">listen</span><span class="o">=</span><span class="n">listen</span><span class="p">,</span> <span class="n">return_figWidget</span><span class="o">=</span><span class="n">return_figWidget</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_figWidget</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Handles all things needed to display the plot in a jupyter notebook</span>

<span class="sd">        Plotly already knows how to show a plot in the jupyter notebook, however</span>
<span class="sd">        here we try to extend it to support shortcuts if the appropiate widget is </span>
<span class="sd">        there (ipyevents, https://github.com/mwcraig/ipyevents).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------</span>
<span class="sd">        return_figureWidget: bool, optional</span>
<span class="sd">            if the plot is displayed in a jupyter notebook, whether you want to</span>
<span class="sd">            get the figure widget as a return so that you can act on it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

        <span class="k">def</span> <span class="nf">_try_backend</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">display</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;listen&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">display_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="s2">&quot;_ipython_display_&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">display_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">display_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Animation</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get_ipywidget</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_try_backend</span><span class="p">()</span>

            <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_widgets</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]:</span>
                <span class="c1"># For now we want provide keyboard shortcut support</span>
                <span class="c1"># If ipyevents is available, show with shortcut support</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ipython_display_with_shortcuts</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Else, show without shortcut support</span>
                <span class="n">display</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_listening_shortcut</span><span class="p">(</span><span class="n">fig_widget</span><span class="o">=</span><span class="n">widget</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">return_figWidget</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">widget</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_try_backend</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ipython_display_with_shortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig_widget</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the appropiate widget is there (ipyevents, https://github.com/mwcraig/ipyevents),</span>
<span class="sd">        we extend plotly&#39;s FigureWidget to support keypress events so that we can trigger</span>
<span class="sd">        shortcuts from the notebook.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------</span>
<span class="sd">        fig_widget: plotly.graph_objs.FigureWidget</span>
<span class="sd">            The figure widget that we need to extend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
        <span class="kn">from</span> <span class="nn">ipyevents</span> <span class="kn">import</span> <span class="n">Event</span>
        <span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">Output</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># This is to display help such as available shortcuts</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># This is to inform about current status</span>
        <span class="n">styles</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;.ipyevents-watched:focus {outline: none}&lt;/style&gt;&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">fig_widget</span><span class="p">,</span> <span class="n">watched_events</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="s1">&#39;keyup&#39;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">handle_dom_events</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">keys_down</span><span class="o">=</span><span class="p">[],</span> <span class="n">last_timestamp</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">keys_up</span><span class="o">=</span><span class="p">[]):</span>
            <span class="c1"># We will keep track of keydowns because then we will be able to support multiple keys shortcuts</span>
            <span class="n">time_threshold</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1">#To remove key up events</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Clear the list</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeStamp&quot;</span><span class="p">)</span>
                <span class="n">duplicates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_down</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keys_down</span><span class="p">))</span>
                <span class="n">time_diff</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">-</span> <span class="n">last_timestamp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">time_diff</span> <span class="o">&gt;</span> <span class="mi">2000</span> <span class="ow">or</span> <span class="n">duplicates</span><span class="p">:</span>
                    <span class="n">keys_down</span> <span class="o">*=</span> <span class="mi">0</span> <span class="c1">#Clear the list</span>
                <span class="k">if</span> <span class="n">time_diff</span> <span class="o">&gt;</span> <span class="n">time_threshold</span><span class="p">:</span>
                    <span class="n">keys_up</span> <span class="o">*=</span> <span class="mi">0</span>

                <span class="n">last_timestamp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>

                <span class="c1"># This means that the key has been held down for a long time</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="k">return</span>

                <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">key_code</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="n">ev_type</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">ev_type</span> <span class="o">==</span> <span class="s2">&quot;keydown&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;control&quot;</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;ctrl&quot;</span>
                    <span class="c1"># If it&#39;s a key down event, record it</span>
                    <span class="n">keys_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ev_type</span> <span class="o">==</span> <span class="s2">&quot;keyup&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_down</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;control&quot;</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;ctrl&quot;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_down</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">keys_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="c1"># If it&#39;s a key up event, anounce that the key is not down anymore</span>
                    <span class="n">keys_down</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

                <span class="n">only_down</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys_down</span><span class="p">)</span>
                <span class="n">shortcut_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys_up</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">only_down</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">shortcut_key</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;border-radius: 3px; background: #ccc; padding: 5px 10px&quot;&gt;</span><span class="si">{</span><span class="n">shortcut_key</span><span class="si">}</span><span class="s1">&lt;/span&gt;&#39;</span>

                <span class="c1"># Get the help message</span>
                <span class="k">if</span> <span class="n">shortcut_key</span> <span class="o">==</span> <span class="s2">&quot;shift+?&quot;</span><span class="p">:</span>
                    <span class="n">h</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcuts_summary</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

                <span class="n">shortcut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcut</span><span class="p">(</span><span class="n">shortcut_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shortcut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">keys_down</span> <span class="o">*=</span> <span class="mi">0</span>
                    <span class="n">keys_up</span> <span class="o">*=</span> <span class="mi">0</span>

                    <span class="n">messages</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Executing &quot;</span><span class="si">{</span><span class="n">shortcut</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot; because you pressed &quot;</span><span class="si">{</span><span class="n">shortcut_key</span><span class="si">}</span><span class="s1">&quot;...&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">call_shortcut</span><span class="p">(</span><span class="n">shortcut_key</span><span class="p">)</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_ipywidget</span><span class="p">(</span><span class="n">fig_widget</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;span style=&quot;color:darkred; font-weight: bold&quot;&gt;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&lt;/span&gt;&#39;</span>

        <span class="n">d</span><span class="o">.</span><span class="n">on_dom_event</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">handle_dom_events</span><span class="p">))</span>

        <span class="n">display</span><span class="p">(</span><span class="n">fig_widget</span><span class="p">,</span> <span class="n">messages</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">Output</span><span class="p">())</span>

    <span class="c1">#-------------------------------------------</span>
    <span class="c1">#       PLOT MANIPULATION METHODS</span>
    <span class="c1">#-------------------------------------------</span>

<div class="viewcode-block" id="Plot.merge"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">others</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s2">&quot;multiple&quot;</span><span class="p">,</span> <span class="n">extend_multiples</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Merges this plot&#39;s instance with the list of plots provided</span>

<span class="sd">        Parameters</span>
<span class="sd">        -------</span>
<span class="sd">        others: array-like of Plot() or Plot()</span>
<span class="sd">            the plots that we want to merge with this plot instance.</span>
<span class="sd">        to: {&quot;multiple&quot;, &quot;subplots&quot;, &quot;animation&quot;}, optional</span>
<span class="sd">            the merge method. Each option results in a different way of putting all the plots</span>
<span class="sd">            together:</span>
<span class="sd">            - &quot;multiple&quot;: All plots are shown in the same canvas at the same time. Useful for direct</span>
<span class="sd">            comparison.</span>
<span class="sd">            - &quot;subplots&quot;: The layout is divided in different subplots.</span>
<span class="sd">            - &quot;animation&quot;: Each plot is converted into the frame of an animation.</span>
<span class="sd">        extend_multiples: boolean, optional</span>
<span class="sd">            if True, if `MultiplePlot`s are passed, they are splitted into their children, so that the result</span>
<span class="sd">            is the merge of its children with the rest.</span>
<span class="sd">            If False, a `MultiplePlot` is treated as a solid unit.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            extra arguments that are directly passed to `MultiplePlot`, `Subplots`</span>
<span class="sd">            or `Animation` initialization.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        MultiplePlot, Subplots or Animation</span>
<span class="sd">            depending on the value of the `to` parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Make sure we deal with a list (user can provide a single plot)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="n">others</span> <span class="o">=</span> <span class="p">[</span><span class="n">others</span><span class="p">]</span>

        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">extend_multiples</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pt</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">MultiplePlot</span><span class="p">)</span> <span class="k">else</span> <span class="n">pt</span><span class="o">.</span><span class="n">children</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">children</span><span class="p">]</span>
            <span class="c1"># Flatten the list</span>
            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span> <span class="k">for</span> <span class="n">plots</span> <span class="ow">in</span> <span class="n">children</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">]</span>

        <span class="n">PlotClass</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;multiple&quot;</span><span class="p">:</span> <span class="n">MultiplePlot</span><span class="p">,</span>
            <span class="s2">&quot;subplots&quot;</span><span class="p">:</span> <span class="n">SubPlots</span><span class="p">,</span>
            <span class="s2">&quot;animation&quot;</span><span class="p">:</span> <span class="n">Animation</span>
        <span class="p">}[</span><span class="n">to</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">PlotClass</span><span class="p">(</span><span class="n">plots</span><span class="o">=</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plot.copy"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns a copy of the plot</span>

<span class="sd">        If you want a plot with the exact plot configuration but newly initialized,</span>
<span class="sd">        use `clone()` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Plot.clone"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Gets you and exact clone of this plot</span>

<span class="sd">        You can pass extra args that will overwrite the previous parameters though, if you don&#39;t want it to be that exact.</span>

<span class="sd">        IMPORTANT: IT WILL INITIALIZE A NEW PLOT, THEREFORE IT WILL READ NEW DATA.</span>
<span class="sd">        IF YOU JUST WANT A COPY, USE THE `copy()` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1">#-------------------------------------------</span>
    <span class="c1">#          LISTENING TO EVENTS</span>
    <span class="c1">#-------------------------------------------</span>

<div class="viewcode-block" id="Plot.dispatch_event"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.dispatch_event">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Not functional yet &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">((</span><span class="n">event</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="c1"># Of course this needs to be done</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

    <span class="c1">#-------------------------------------------</span>
    <span class="c1">#       DATA TRANSFER/STORAGE METHODS</span>
    <span class="c1">#-------------------------------------------</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the object to be pickled&quot;&quot;&quot;</span>
        <span class="c1"># We just simply remove any sile from the settings history (as they are not pickleable)</span>
        <span class="c1"># and replace it with a posix path. Note that this does not fix the problem if there are</span>
        <span class="c1"># nested siles.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings_history</span><span class="o">.</span><span class="n">_vals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings_history</span><span class="o">.</span><span class="n">_vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">file</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">sisl</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">BaseSile</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

<div class="viewcode-block" id="Plot.save"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Plot.html#sisl.viz.Plot.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Saves the plot so that it can be loaded in the future</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        path: str</span>
<span class="sd">            The path to the file where you want to save the plot</span>

<span class="sd">        Returns</span>
<span class="sd">        ---------</span>
<span class="sd">        self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">dill</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">dill</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div></div>


<span class="k">class</span> <span class="nc">EntryPoint</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sort_key</span><span class="p">,</span> <span class="n">setting_key</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_key</span> <span class="o">=</span> <span class="n">sort_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method_attr</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setting_key</span> <span class="o">=</span> <span class="n">setting_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="vm">__doc__</span>


<span class="k">def</span> <span class="nf">entry_point</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sort_key</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Helps registering entry points for plots</span>

<span class="sd">    See the usage section to get a fast intuitive way of how to use it.</span>

<span class="sd">    Basically, you need to provide some parameters (which are described</span>
<span class="sd">    in the parameters section), and this function will return a decorator that</span>
<span class="sd">    you can use in the functions of your plot class that do the reading part.</span>

<span class="sd">    A function that is meant to read data but it&#39;s not marked as an entry_point</span>
<span class="sd">    will be invisible to Plot.</span>

<span class="sd">    NOTE: A plot class can have no entry points. This is perfectly fine if the </span>
<span class="sd">    class does not need to read data for some reason. In this case, we will go straight</span>
<span class="sd">    into the data setting methods (i.e. set_data).</span>

<span class="sd">    Examples</span>
<span class="sd">    -----------</span>

<span class="sd">    &gt;&gt;&gt; class MyPlot(Plot):</span>
<span class="sd">    &gt;&gt;&gt;     @entry_point(&#39;siesta_output&#39;)</span>
<span class="sd">    &gt;&gt;&gt;     def _lets_read_from_siesta_output(self):</span>
<span class="sd">    &gt;&gt;&gt;         ...do some work here</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt;     @entry_point(&#39;ask_mum&#39;):</span>
<span class="sd">    &gt;&gt;&gt;     def _we_are_quite_lost_so_we_better_ask_mum(self):</span>
<span class="sd">    &gt;&gt;&gt;         self.call_mum()</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    name: str</span>
<span class="sd">        the name of the entry point that the decorated function implements.</span>
<span class="sd">    sort_key: any</span>
<span class="sd">        the entry points order will be sorted according to this key.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">EntryPoint</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sort_key</span><span class="p">,</span> <span class="p">())</span>

<span class="c1">#------------------------------------------------</span>
<span class="c1">#       CLASSES TO SUPPORT COMPOSITE PLOTS</span>
<span class="c1">#------------------------------------------------</span>


<div class="viewcode-block" id="MultiplePlot"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot">[docs]</a><span class="k">class</span> <span class="nc">MultiplePlot</span><span class="p">(</span><span class="n">Plot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; General handler of a group of plots that need to be rendered together</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root_fdf: fdfSileSiesta, optional</span>
<span class="sd">        Path to the fdf file that is the &#39;parent&#39; of the results.</span>
<span class="sd">    results_path: str, optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    entry_points_order: array-like, optional</span>
<span class="sd">        Order with which entry points will be attempted.</span>
<span class="sd">    backend:  optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_trigger_kw</span> <span class="o">=</span> <span class="s2">&quot;varying&quot;</span>

<div class="viewcode-block" id="MultiplePlot.__init__"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Take the plots if they have already been created and are provided by the user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PLOTS_PROVIDED</span> <span class="o">=</span> <span class="n">plots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PLOTS_PROVIDED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_children</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_template_plot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">template_plot</span><span class="p">,</span> <span class="n">Plot</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template_plot</span> <span class="o">=</span> <span class="n">template_plot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_template_plot</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Gets a given child plot &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_kw_from_cls</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_trigger_kw</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cls_from_kw</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">MultiplePlot</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_trigger_kw</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_attrs_for_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns all the attributes that its children should have &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;isChildPlot&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;_get_shared_attr&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_attr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
            <span class="s1">&#39;share_attr&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_shared_attr</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="p">}</span>

<div class="viewcode-block" id="MultiplePlot.init_all_plots"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.init_all_plots">[docs]</a>    <span class="k">def</span> <span class="nf">init_all_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">try_sharing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initializes all child plots</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        update_fig: boolean, optional</span>
<span class="sd">            whether we should build the figure if this step is succesful.</span>
<span class="sd">        try_sharing: boolean, optional</span>
<span class="sd">            If `True`, we will check if all plots have exactly the same settings to read</span>
<span class="sd">            data and, in that case, they will share attributes to avoid memory waste.</span>

<span class="sd">            This is specially essential for plots that read big amounts of data (e.g. `GridPlot`),</span>
<span class="sd">            but also for those that take significant time to read it. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">PLOTS_PROVIDED</span><span class="p">:</span>

            <span class="c1"># If there is a template plot, take its settings as the starting point</span>
            <span class="n">template_settings</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_template_plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_plot</span><span class="o">.</span><span class="vm">__class__</span>
                <span class="n">template_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_plot</span><span class="o">.</span><span class="n">settings</span>

            <span class="n">SINGLE_CLASS</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plot_classes</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>

            <span class="c1"># Initialize all the plots</span>
            <span class="c1"># In case there is only one class only initialize them, avoid reading data</span>
            <span class="c1"># In this case, it is extremely important to initialize them all in serial mode, because</span>
            <span class="c1"># with multiprocessing they won&#39;t know that the current instance is their parent</span>
            <span class="c1"># (objects get copied in multiprocessing) and they won&#39;t be able to share data</span>
            <span class="n">plots</span> <span class="o">=</span> <span class="n">init_multiple_plots</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plot_classes</span><span class="p">,</span>
                <span class="n">kwargsList</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span><span class="o">**</span><span class="n">template_settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="s2">&quot;attrs_for_plot&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs_for_children</span><span class="p">,</span> <span class="s2">&quot;only_init&quot;</span><span class="p">:</span> <span class="n">SINGLE_CLASS</span> <span class="ow">and</span> <span class="n">try_sharing</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInitKwargsList</span><span class="p">()</span>
                <span class="p">],</span>
                <span class="n">serial</span><span class="o">=</span><span class="n">SINGLE_CLASS</span> <span class="ow">and</span> <span class="n">try_sharing</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">SINGLE_CLASS</span> <span class="ow">and</span> <span class="n">try_sharing</span><span class="p">:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_template_plot</span><span class="p">:</span>
                    <span class="c1"># Our leading plot will be the first one</span>
                    <span class="n">leading_plot</span> <span class="o">=</span> <span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">leading_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_plot</span>

                <span class="c1"># Now, we get the settings of the first plot</span>
                <span class="n">read_data_settings</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">key</span><span class="p">:</span> <span class="n">leading_plot</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">funcs</span> <span class="ow">in</span> <span class="n">leading_plot</span><span class="o">.</span><span class="n">_run_on_update</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">leading_plot</span><span class="o">.</span><span class="n">read_data_methods</span><span class="p">)</span>
                <span class="p">}</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plots</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="o">.</span><span class="n">has_these_settings</span><span class="p">(</span><span class="n">read_data_settings</span><span class="p">):</span>
                        <span class="c1"># If there is a plot that needs to read different data, we will just</span>
                        <span class="c1"># make each of them read their own data. (this could be optimized by grouping plots)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">init_all_plots</span><span class="p">(</span><span class="n">try_sharing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># In case there is no plot that has different settings, we will</span>
                    <span class="c1"># happily set the data, avoiding the read data step. Plots will take</span>
                    <span class="c1"># their missing attributes from the shared store or from the plot</span>
                    <span class="c1"># template</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_children</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_template_plot</span><span class="p">:</span>
                        <span class="n">leading_plot</span><span class="o">.</span><span class="n">_SHOULD_SHARE_WITH_SIBLINGS</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">leading_plot</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">update_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">leading_plot</span><span class="o">.</span><span class="n">_SHOULD_SHARE_WITH_SIBLINGS</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If we haven&#39;t tried sharing data, the plots are already prepared (with read data of their own)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_children</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span>

            <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_after_children_updated&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">update_fig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="MultiplePlot.update_children_settings"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.update_children_settings">[docs]</a>    <span class="k">def</span> <span class="nf">update_children_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children_sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Updates the settings of all child plots</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        children_sel: array-like of int, optional</span>
<span class="sd">            The indices of the child plots that you want to update.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Keyword arguments specifying the settings that you want to update</span>
<span class="sd">            and the values you want them to have</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">on_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_parent_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">children_sel</span><span class="o">=</span><span class="n">children_sel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on_children</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">on_parent_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">children_sel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This method takes into account that on plots that contain children, one may want to update only the parent settings or all the child&#39;s settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        on_children: boolean, optional</span>
<span class="sd">            whether the settings should be updated on child plots</span>
<span class="sd">        on_parent_plot: boolean, optional</span>
<span class="sd">            whether the settings should be updated on the parent plot.</span>
<span class="sd">        children_sel: array-like of int, optional</span>
<span class="sd">            The indices of the child plots that you want to update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on_parent_plot</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_update_settings</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">on_children</span><span class="p">:</span>

            <span class="n">repeat_if_children</span><span class="p">(</span><span class="n">Configurable</span><span class="o">.</span><span class="n">_update_settings</span><span class="p">)(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children_sel</span><span class="o">=</span><span class="n">children_sel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">call_method_if_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_after_children_updated&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="MultiplePlot.set_children"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.set_children">[docs]</a>    <span class="k">def</span> <span class="nf">set_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plots</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Sets the children of a multiple plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        --------</span>
<span class="sd">        plots: array-like of sisl.viz.plotly.Plot or plotly Figure</span>
<span class="sd">            the plots that should be set as children for the animation. </span>
<span class="sd">        keep: boolean, optional</span>
<span class="sd">            whether the existing children should be kept.</span>

<span class="sd">            If `True`, `plots` is added after them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">plot</span> <span class="ow">in</span> <span class="n">plots</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrs_for_children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">plots</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span> <span class="k">else</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="o">*</span><span class="n">plots</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="MultiplePlot.add_children"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.add_children">[docs]</a>    <span class="k">def</span> <span class="nf">add_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">plots</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Append children to the existing ones</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        *plots: Plot</span>
<span class="sd">            all the plots that you want to add as child plots of this one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_children</span><span class="p">(</span><span class="n">plots</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiplePlot.insert_childplot"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.insert_childplot">[docs]</a>    <span class="k">def</span> <span class="nf">insert_childplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">plot</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Inserts a plot in a given position of the children list</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            The position where the plot should be inserted</span>
<span class="sd">        plot: sisl Plot or plotly Figure</span>
<span class="sd">            The plot to insert in the list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">plot</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiplePlot.shared_attr"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.shared_attr">[docs]</a>    <span class="k">def</span> <span class="nf">shared_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Gets an attribute that is located in the shared storage of the MultiplePlot</span>

<span class="sd">        This method will be given to all children so that they can retreive the shared</span>
<span class="sd">        attributes. This is done in `set_children`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        key: str</span>
<span class="sd">            the name of the attribute that you want to retrieve</span>

<span class="sd">        Returns</span>
<span class="sd">        -----------</span>
<span class="sd">        any</span>
<span class="sd">            the value that you asked for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If from the beggining there is a template plot, the shared</span>
        <span class="c1"># storage is actually that plot.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_template_plot</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_plot</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="MultiplePlot.set_shared_attr"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.set_shared_attr">[docs]</a>    <span class="k">def</span> <span class="nf">set_shared_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Sets the value of a shared attribute</span>

<span class="sd">        Parameters</span>
<span class="sd">        ------------</span>
<span class="sd">        key: str</span>
<span class="sd">            the key of the attribute that is to be set.</span>
<span class="sd">        val: any</span>
<span class="sd">            the new value for the attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="MultiplePlot.get_figure"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.MultiplePlot.html#sisl.viz.MultiplePlot.get_figure">[docs]</a>    <span class="k">def</span> <span class="nf">get_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_for_backend&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Animation"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Animation.html#sisl.viz.Animation">[docs]</a><span class="k">class</span> <span class="nc">Animation</span><span class="p">(</span><span class="n">MultiplePlot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Version of MultiplePlot that renders each plot in a different animation frame</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame_duration: int, optional</span>
<span class="sd">        Time (in ms) that each frame will be displayed.  This is only</span>
<span class="sd">        meaningful in the plotly backend</span>
<span class="sd">    interpolated_frames: int, optional</span>
<span class="sd">        The number of frames that should be interpolated between two plots.</span>
<span class="sd">        This is only meaningful in the blender backend.</span>
<span class="sd">    redraw: bool, optional</span>
<span class="sd">        Whether each frame of the animation should be redrawn</span>
<span class="sd">        If False, the animation will try to interpolate between one frame and</span>
<span class="sd">        the other             Set this to False if you are sure that the</span>
<span class="sd">        frames contain the same number of traces, otherwise new traces will</span>
<span class="sd">        not appear.</span>
<span class="sd">    ani_method:  optional</span>
<span class="sd">        It determines how the animation is rendered.</span>
<span class="sd">    root_fdf: fdfSileSiesta, optional</span>
<span class="sd">        Path to the fdf file that is the &#39;parent&#39; of the results.</span>
<span class="sd">    results_path: str, optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    entry_points_order: array-like, optional</span>
<span class="sd">        Order with which entry points will be attempted.</span>
<span class="sd">    backend:  optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_trigger_kw</span> <span class="o">=</span> <span class="s2">&quot;animate&quot;</span>

    <span class="n">_isAnimation</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_param_groups</span> <span class="o">=</span> <span class="p">(</span>

        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;animation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Animation specific settings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="s2">&quot;videocam&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The fact that you have not studied cinematography is not a good excuse for creating ugly animations. &lt;b&gt;Customize your animation with these settings&lt;/b&gt;&quot;</span>
        <span class="p">},</span>

    <span class="p">)</span>

    <span class="n">_parameters</span> <span class="o">=</span> <span class="p">(</span>

        <span class="n">IntegerInput</span><span class="p">(</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;frame_duration&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Frame duration&quot;</span><span class="p">,</span>
            <span class="n">default</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
            <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;animation&quot;</span><span class="p">,</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">},</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Time (in ms) that each frame will be displayed. &lt;br&gt; This is only meaningful in the plotly backend&quot;</span>
        <span class="p">),</span>

        <span class="n">IntegerInput</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s2">&quot;interpolated_frames&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Frames between images&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="s2">&quot;animation&quot;</span><span class="p">,</span>
            <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;The number of frames that should be interpolated between two plots. This is only meaningful in the blender backend.&quot;</span>
        <span class="p">),</span>

        <span class="n">BoolInput</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;redraw&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Redraw each frame&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="s1">&#39;animation&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Whether each frame of the animation should be redrawn&lt;br&gt;</span>
<span class="s2">            If False, the animation will try to interpolate between one frame and the other&lt;br&gt;</span>
<span class="s2">            Set this to False if you are sure that the frames contain the same number of traces, otherwise new traces will not appear.&quot;&quot;&quot;</span>
        <span class="p">),</span>

        <span class="n">OptionsInput</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s1">&#39;ani_method&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Animation method&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">group</span><span class="o">=</span><span class="s1">&#39;animation&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Choose the animation method...&quot;</span><span class="p">,</span>
                <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Update&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">},</span>
                    <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Animate&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;animate&quot;</span><span class="p">},</span>
                <span class="p">],</span>
                <span class="s2">&quot;isClearable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;isSearchable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;isMulti&quot;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">},</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;It determines how the animation is rendered. &quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="p">)</span>

<div class="viewcode-block" id="Animation.__init__"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Animation.html#sisl.viz.Animation.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">frame_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_plugins</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">frame_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_plugins</span><span class="p">[</span><span class="s2">&quot;_get_frame_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_names</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">frame_names</span><span class="p">)</span> <span class="k">else</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">frame_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;_get_frame_names&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_plugins</span><span class="p">:</span>
            <span class="n">_plugins</span><span class="p">[</span><span class="s2">&quot;_get_frame_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Frame </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">_plugins</span><span class="o">=</span><span class="n">_plugins</span><span class="p">)</span></div>

<div class="viewcode-block" id="Animation.get_figure"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.Animation.html#sisl.viz.Animation.get_figure">[docs]</a>    <span class="k">def</span> <span class="nf">get_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">interpolated_frames</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_for_backend&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Get the names for each frame</span>
        <span class="n">frame_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="n">frame_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame_names</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">frame_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span><span class="p">[</span><span class="s2">&quot;frame_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span><span class="p">[</span><span class="s2">&quot;interpolated_frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolated_frames</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SubPlots"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.SubPlots.html#sisl.viz.SubPlots">[docs]</a><span class="k">class</span> <span class="nc">SubPlots</span><span class="p">(</span><span class="n">MultiplePlot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Version of MultiplePlot that renders each plot in a separate subplot</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    arrange:  optional</span>
<span class="sd">        The way in which subplots should be aranged if the `rows` and/or</span>
<span class="sd">        `cols`             parameters are not provided.</span>
<span class="sd">    rows: int, optional</span>
<span class="sd">        The number of rows of the plot grid. If not provided, it will be</span>
<span class="sd">        inferred from `cols`             and the number of plots. If neither</span>
<span class="sd">        `cols` or `rows` are provided, the `arrange` parameter will decide</span>
<span class="sd">        how the layout should look like.</span>
<span class="sd">    cols: int, optional</span>
<span class="sd">        The number of columns of the subplot grid. If not provided, it will</span>
<span class="sd">        be inferred from `rows`             and the number of plots. If</span>
<span class="sd">        neither `cols` or `rows` are provided, the `arrange` parameter will</span>
<span class="sd">        decide             how the layout should look like.</span>
<span class="sd">    make_subplots_kwargs: dict, optional</span>
<span class="sd">        Extra keyword arguments that will be passed to make_subplots.</span>
<span class="sd">    root_fdf: fdfSileSiesta, optional</span>
<span class="sd">        Path to the fdf file that is the &#39;parent&#39; of the results.</span>
<span class="sd">    results_path: str, optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    entry_points_order: array-like, optional</span>
<span class="sd">        Order with which entry points will be attempted.</span>
<span class="sd">    backend:  optional</span>
<span class="sd">        Directory where the files with the simulations results are</span>
<span class="sd">        located. This path has to be relative to the root fdf.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_trigger_kw</span> <span class="o">=</span> <span class="s2">&quot;subplots&quot;</span>

    <span class="n">_is_subplots</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_parameters</span> <span class="o">=</span> <span class="p">(</span>

        <span class="n">OptionsInput</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;arrange&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Automatic arrangement method&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">option</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">option</span><span class="p">}</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;rows&#39;</span><span class="p">,</span> <span class="s1">&#39;cols&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="s1">&#39;placeholder&#39;</span><span class="p">:</span> <span class="s1">&#39;Choose a subplot arrangement method...&#39;</span><span class="p">,</span>
                <span class="s1">&#39;isMulti&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;isSearchable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;isClearable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;The way in which subplots should be aranged if the `rows` and/or `cols`</span>
<span class="s2">            parameters are not provided.&quot;&quot;&quot;</span>
        <span class="p">),</span>

        <span class="n">IntegerInput</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Rows&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;The number of rows of the plot grid. If not provided, it will be inferred from `cols`</span>
<span class="s2">            and the number of plots. If neither `cols` or `rows` are provided, the `arrange` parameter will decide</span>
<span class="s2">            how the layout should look like.&quot;&quot;&quot;</span>
        <span class="p">),</span>

        <span class="n">IntegerInput</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;cols&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Columns&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;The number of columns of the subplot grid. If not provided, it will be inferred from `rows`</span>
<span class="s2">            and the number of plots. If neither `cols` or `rows` are provided, the `arrange` parameter will decide</span>
<span class="s2">            how the layout should look like.&quot;&quot;&quot;</span>
        <span class="p">),</span>

        <span class="n">ProgramaticInput</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;make_subplots_kwargs&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;make_subplot additional arguments&#39;</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Extra keyword arguments that will be passed to make_subplots.&quot;&quot;&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>

<div class="viewcode-block" id="SubPlots.get_figure"><a class="viewcode-back" href="../../../api/viz/generated/sisl.viz.SubPlots.html#sisl.viz.SubPlots.get_figure">[docs]</a>    <span class="k">def</span> <span class="nf">get_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">arrange</span><span class="p">,</span> <span class="n">make_subplots_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Builds the subplots layout from the child plots&#39; data &quot;&quot;&quot;</span>
        <span class="n">nplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arrange</span> <span class="o">==</span> <span class="s1">&#39;rows&#39;</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">nplots</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">arrange</span> <span class="o">==</span> <span class="s1">&#39;cols&#39;</span><span class="p">:</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">nplots</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">arrange</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">nplots</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">nplots</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="c1"># we will correct so it *fits*, always have more columns</span>
                <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
                <span class="n">cols</span> <span class="o">=</span> <span class="n">nplots</span> <span class="o">//</span> <span class="n">rows</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nplots</span> <span class="o">%</span> <span class="n">rows</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ensure it is large enough by adding 1 if they don&#39;t add up</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">nplots</span> <span class="o">//</span> <span class="n">cols</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nplots</span> <span class="o">%</span> <span class="n">cols</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ensure it is large enough by adding 1 if they don&#39;t add up</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">nplots</span> <span class="o">//</span> <span class="n">rows</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nplots</span> <span class="o">%</span> <span class="n">rows</span><span class="p">)</span>

        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cols</span> <span class="o">*</span> <span class="n">rows</span> <span class="o">&lt;</span> <span class="n">nplots</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;requested </span><span class="si">{</span><span class="n">nplots</span><span class="si">}</span><span class="s2"> on a </span><span class="si">{</span><span class="n">rows</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">cols</span><span class="si">}</span><span class="s2"> grid layout. </span><span class="si">{</span><span class="n">nplots</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cols</span><span class="o">*</span><span class="n">rows</span><span class="si">}</span><span class="s2"> plots will be missing.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_for_backend</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;rows&quot;</span><span class="p">:</span> <span class="n">rows</span><span class="p">,</span>
            <span class="s2">&quot;cols&quot;</span><span class="p">:</span> <span class="n">cols</span><span class="p">,</span>
            <span class="s2">&quot;make_subplots_kwargs&quot;</span><span class="p">:</span> <span class="n">make_subplots_kwargs</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_figure</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2023, Nick Papior.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>